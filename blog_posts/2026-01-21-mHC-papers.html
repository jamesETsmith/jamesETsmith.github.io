<!DOCTYPE HTML>
<html lang="en" data-theme="light">

<head>
    <title>Paper Speedrun Manifold-Constrained Hyper-Connections - James E. T. Smith, Ph.D.</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="description" content="Quick summary of the mHC paper to help me learn about it." />
    <meta name="keywords" content="deepseek model architecture resnet" />
    <link rel="stylesheet" href="../assets/css/minimal.css" />
    <link rel="icon" href="../images/k4_planar.svg">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/vs.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                tags: 'ams'
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
</head>

<body>
    <div class="container">
        <header>
            <div class="header-container">
                <div class="header-content">
                    <h1>James E. T. Smith, Ph.D.</h1>
                    <nav>
                        <ul>
                            <li><a href="../index.html#about">About</a></li>
                            <li><a href="../index.html#software">Software</a></li>
                            <li><a href="../publications.html">Publications</a></li>
                            <li><a href="../index.html#talks">Talks</a></li>
                            <li><a href="../blog.html" class="active">Blog</a></li>
                            <li><a href="../index.html#contact">Contact</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="header-image">
                    <img src="../images/headshot_small.png" alt="James E. T. Smith" />
                </div>
            </div>
        </header>

        <main>
            <article class="blog-post-content">
                <header class="post-header">
                    <h2>Paper Speedrun Manifold-Constrained Hyper-Connections</h2>
                    <div class="post-meta">
                        <time datetime="2026-01-21">January 21, 2026</time>
                        <div class="post-tags">
                            
                            <span class="tag">deepseek</span>
                            
                            <span class="tag">model architecture</span>
                            
                            <span class="tag">resnet</span>
                            
                        </div>
                    </div>
                </header>

                <section class="post-section has-margin-notes">
                    <h2>Sources</h2>
<ul>
<li>Original paper from DeepSeek team: <a href="https://www.arxiv.org/pdf/2512.24880">https://www.arxiv.org/pdf/2512.24880</a></li>
<li>Hyper-connections paper from the ByteDance team: <a href="https://arxiv.org/pdf/2409.19606">https://arxiv.org/pdf/2409.19606</a></li>
<li>ResNet paper: <a href="https://arxiv.org/pdf/1512.03385">https://arxiv.org/pdf/1512.03385</a></li>
<li>Sinkhorn-Knopp Algorithm: <a href="https://msp.org/pjm/1967/21-2/pjm-v21-n2-p14-s.pdf">https://msp.org/pjm/1967/21-2/pjm-v21-n2-p14-s.pdf</a></li>
<li>Great overiew on youtube from Jin-Bin Huang: <a href="https://www.youtube.com/watch?v=jYn_1PpRzxI">https://www.youtube.com/watch?v=jYn_1PpRzxI</a></li>
</ul>
<h2>Speed RunüèÉ‚Äç‚ôÇÔ∏è</h2>
<p>The authors have summarized their adaptation of the Hyper-Connections architecture very nicely in the TOC figure, shown below. This post will be follow the story outlined in that figure and walk through each of the subfigures.</p>
<p><img src="/images/mHC_overview.png" alt="mHC paper overview" style="max-width:100%; height:auto;" /></p>
<h3>Residual Connection</h3>
<p>$$ x_{l+1} = x_l + \mathcal{F}(x_l, W_l) $$</p>
<p>This architecture means that deep networks will maintain signal from the input at an arbitrary depth.
<a href="https://arxiv.org/pdf/1603.05027">He et al</a> showed that this "identity mapping" property maintains stability and efficiency during large scale training.
Note that residual connections are a key design element used in LLMs although they tend to look more complicated in practice.</p>
<p>Generalizing to a network with a shallow ($l$) and deep ($L$) portion:</p>
<p>$$ \mathbf{x}_L = \mathbf{x}_l + \sum_{i=l}^{L-1} \mathcal{F}(\mathbf{x}_i, \mathcal{W}_i) $$</p>
<h3>Hyper-Connections</h3>
<div class="admonition key-points">
<p class="admonition-title">Key-points</p>
<ul>
<li>FLOPs don't increase significantly because they only increases the expansion rate by "small" factors like 4.</li>
</ul>
</div>
<p>Increasing the capacity/complexity of the residual connections isn't a new area of research, but the introduction of hyper-connections is interesting for several reasons: 1) it greatly increases the topological complexity without significantly increasing the operational complexity of the residual units, 2) it yielded noticeably better benchmark results for smaller models, 3) but training instability limited the size of models to 27B parameters (for reference DeepSeek-V3 has 671B parameters).</p>
<p>$$ \mathbf{x}_{l+1} = \mathcal{H}_l^{\text{res}} \mathbf{x}_l + \mathcal{H}_l^{\text{post} \top} \mathcal{F}(\mathcal{H}_l^{\text{pre}} \mathbf{x}_l, \mathcal{W}_l) $$</p>
<ul>
<li>$ \mathcal{H}_l^{res} \in \mathbb{R}^{nxn}$ is a learnable mapping that mixes features within the residual stream</li>
<li>$ \mathcal{H}_l^{pre} \in \mathbb{R}^{1xn} $ is a learnable mapping that aggregates features from the nC-dim stream into a C-dim layer input</li>
<li>$ \mathcal{H}_l^{post} \in \mathbb{R}^{1xn} $ is a learnable mapping that maps the layer output back onto the stream.</li>
</ul>
<p>Looking at a recursive formula, it's easier to see where the instability from $\mathcal{H}_l^{res}$ can come from:</p>
<p>$$ \mathbf{x}_L = \left( \prod_{i=1}^{L-l} \mathcal{H}_{L-i}^{\text{res}} \right) \mathbf{x}_l + \sum_{i=l}^{L-1} \left( \prod_{j=1}^{L-1-i} \mathcal{H}_{L-j}^{\text{res}} \right) \mathcal{H}_i^{\text{post} \top} \mathcal{F}(\mathcal{H}_i^{\text{pre}} \mathbf{x}_i, \mathcal{W}_i) $$</p>
<p>As we apply the different $$ \mathbf{x}_L = \mathbf{x}_l + \sum_{i=l}^{L-1} \mathcal{F}(\mathbf{x}_i, \mathcal{W}_i) $$0 matrices repeatedly, we can amplify or suppress signal from our input and for large network depths this can lead to gradient explosion or vanishing.</p>
<blockquote>
<p>Why does't it add to the FLOPs by a noticeable amount for each computer unit?</p>
</blockquote>
<h3>Manifold-Constrained Hyper-Connections</h3>
<p>In Manifold-Constrained Hyper-Connections (mHC), the authors project $$ \mathbf{x}_L = \mathbf{x}_l + \sum_{i=l}^{L-1} \mathcal{F}(\mathbf{x}_i, \mathcal{W}_i) $$1 </p>
<p><img src="/images/mHC_training_instability.png" alt="mHC training instability illustration" style="max-width:100%; height:auto;" /></p>
<div class="admonition implementation sinkhorn-knopp algorithm">
<p class="admonition-title">Implementation</p>
<p>Here's an implementation of the sinkhorn-knopp algorithm</p>
</div>
<ul>
<li>Introduces only a 6.7% time overhead when exapansion rate is $$ \mathbf{x}_L = \mathbf{x}_l + \sum_{i=l}^{L-1} \mathcal{F}(\mathbf{x}_i, \mathcal{W}_i) $$2.</li>
</ul>
                </section>
            </article>

            <div class="post-navigation">
                <a href="../blog.html" class="button"><i class="fas fa-arrow-left"></i> Back to All Posts</a>
            </div>
        </main>

        <footer>
            <p>&copy; James E. T. Smith, Ph.D.</p>
        </footer>
    </div>

    <!-- Theme toggle button -->
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Theme toggle script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Theme toggle functionality
            const themeToggle = document.getElementById('theme-toggle');
            const htmlElement = document.documentElement;
            const themeIcon = themeToggle.querySelector('i');

            // Check for saved theme preference or use device preference
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            // Set initial theme
            if (savedTheme) {
                htmlElement.setAttribute('data-theme', savedTheme);
                updateThemeIcon(savedTheme);
            } else if (prefersDark) {
                htmlElement.setAttribute('data-theme', 'dark');
                updateThemeIcon('dark');
            }

            // Toggle theme when button is clicked
            themeToggle.addEventListener('click', () => {
                const currentTheme = htmlElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                htmlElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
            });

            // Update icon based on current theme
            function updateThemeIcon(theme) {
                if (theme === 'dark') {
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                } else {
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                }
            }
        });
    </script>
    
</body>

</html>
